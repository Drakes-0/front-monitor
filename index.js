!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e._FEEMonitor=t()}(this,function(){"use strict";var e={handler:function(){},catchUnhandledRejection:!0,xhrRule:function(e){return 200!==e&&304!==e}},t={interval:5e3,retry:3},n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e){return"string"==typeof e}var u=function(){function e(n){r(this,e),this.interval=t.interval,this.retry=t.retry,this.timer=null,this.queue=[],this.handler=n,this.retries=0}return o(e,[{key:"push",value:function(e){var t=this;this.retries>=this.retry||(this.queue.push(e),null===this.timer&&(this.timer=setTimeout(function(){t.flush()},this.interval)))}},{key:"flush",value:function(){var e=this,t=this.queue.slice();this.queue=[],this.timer=null,t.forEach(function(t){try{e.handler(t)}catch(n){console.error(n,t),e.retries++}})}}]),e}(),a=function(){function t(n){r(this,t),this.config=Object.assign(Object.assign({},e),n),this.reporter=new u(this.config.handler),this.catchResourceAndRuntimeError(),this.catchXHRError(this.config.xhrRule),this.config.catchUnhandledRejection&&this.catchUnhandledRejection()}return o(t,[{key:"catchResourceAndRuntimeError",value:function(){"function"!=typeof window.addEventListener&&(window.addEventListener=function(e,t){window.attachEvent("on"+e,function(e){e.target=e.srcElement,e.currentTarget=window,t.call(window,e)})});var e=this;window.addEventListener("error",function(t){t&&(t.target===window?e.throwError(FEErrorTypeEnum.RUNTIME,i(t)?t:t.message||"",{colno:t.colno||0,lineno:t.lineno||0,filename:t.filename||""}):t.target instanceof HTMLElement&&e.throwError(FEErrorTypeEnum.RESOURCE,"load "+t.target.tagName+" resource:"+(t.target.src||t.target.href)+" failed"))},!0)}},{key:"catchUnhandledRejection",value:function(){var e=this;window.addEventListener("unhandledrejection",function(t){var r,o="object"===(void 0===(r=t.reason)?"undefined":n(r))&&null!==r?t.reason.stack:t.reason;e.throwError(FEErrorTypeEnum.UNHANDLED,o)},!0)}},{key:"catchXHRError",value:function(e){var t=XMLHttpRequest.prototype.open,n=XMLHttpRequest.prototype.send,r=this;XMLHttpRequest.prototype.open=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];var o=n[0],i=n[1];return this._openData={method:o,url:i},t.apply(this,n)},XMLHttpRequest.prototype.send=function(){var t=this,o=t.onreadystatechange;t.onreadystatechange=function(){if(o&&o.call(t),4===t.readyState){if("function"==typeof e){if(e(t.status,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!i(e)||!e.length)return t;try{return JSON.parse(e)}catch(n){return console.error(n,e),t}}(t.responseText,{})))return}else{if(!(e instanceof RegExp))return;if(e.test(t.status+""))return}var n=t._openData||{},u=n.method,a=void 0===u?"Request":u,c=n.url,s=void 0===c?"unknown":c;r.throwError(FEErrorTypeEnum.XHR,a+" "+s+" failed")}};for(var u=arguments.length,a=Array(u),c=0;c<u;c++)a[c]=arguments[c];return n.apply(t,a)}}},{key:"throwError",value:function(e,t,n){this.reporter.push({referrer:window.location.href,type:e,time:Date.now(),message:t,info:n})}}]),t}();return function(e){"undefined"==typeof window||window._feeminjected||(window._feeminjected=!0,window._feemins=new a(e))}});
