var ExceptionMonitor=function(){"use strict";var e={distinct:!0,silent:!1,bufferTime:2e3,bufferSize:20,xhrErrorLevel:"4/5",catchUnhandledrejection:!1,cacheKey:"MonitorErrorCache",reportUrl:"http://127.0.0.1:8080",postFields:["message","type","resource","line","column","ua"]},t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){return function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=Object.create(null);return e.forEach(function(e,t){i[e]=n[t]||""}),i}},o=function(e){return e=e.split(/\//),function(t){return e.some(function(e){return t.startsWith(e)})}},u=function(){function e(t,r,i,o,u){n(this,e),this.reporter=t,this.cacheKey=r,this.distinct=i,this.bufferTime=Math.min(o,1e4),this.bufferSize=Math.min(u,100),this.timer=void 0,this.queue=[]}return r(e,[{key:"push",value:function(e){var t=this;this.distinct&&this.queue.some(function(t){return function(e,t){for(var n=Object.keys(e),r=0;r<n.length;r++)if(e[n[r]]!==t[n[r]])return!1;return!0}(t,e)})||(this.queue.push(e),this.timer&&clearTimeout(this.timer),this.length>=this.bufferSize?this.flush():this.timer=setTimeout(function(){t.flush.call(t)},this.bufferTime))}},{key:"flush",value:function(){var e=this.queue.slice(0);this.queue.length=0,this.reporter.report(e)}}]),e}(),s=function(e,n,r,i){if(e.addEventListener("error",function(r){var o,u=r.message,s=r.filename,c=r.lineno,f=r.colno,a=r.target;return"object"===(void 0===(o=a)?"undefined":t(o))&&null!==o&&(a===e?i(u,"RUNTIME",s,c,f,navigator.userAgent):i("Loading resource failed","RESOURCE",a.src||a.href)),!!n},!0),r){e.addEventListener("unhandledrejection",function(e){return i("Uncaught in promise : "+e.reason,"UNHANDLEDREJECTION"),!!n},!0)}},c=function(e,t){var n=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(){var r="string"==typeof arguments[0]?arguments[0].toUpperCase():"Request";return this.addEventListener("load",function(){var n=this.status+"";e(n)&&t(r+" "+this.responseURL+" failed","AJAX")}),n.apply(this,arguments)}},f=function(){function e(t){n(this,e),this.reportUrl=t}return r(e,[{key:"report",value:function(e){e.forEach(console.log)}}]),e}(),a=function(e){return new f(e)};return function(t){if("undefined"==typeof window)return console.error("Monitor need browser environment");var n=window,r=Object.assign({},e,t),f=i(r.postFields),l=o(r.xhrErrorLevel),h=new u(a(r.reportUrl),r.cacheKey,r.distinct,r.bufferTime,r.bufferSize),p=function(){h.push(f.apply(void 0,arguments))};c(l,p),s(n,r.silent,r.catchUnhandledrejection,p)}}();
